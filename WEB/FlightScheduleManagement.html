<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Schedule Management</title>
    <link rel="stylesheet" href="./css/airline.css">
    <link rel="stylesheet" href="./css/font-awesome-4.7.0/css/font-awesome.min.css">
    <script src="./js/jquery-3.4.1.min.js"></script>

</head>

<body>
    <div class="top">
        <div class="logo">
            <img class="logoimg" src="./image/logo/logo1.png" alt="">
        </div>
        <div class="status">
            Administrator Menu
        </div>
    </div>
    <div class="menulist">
        <div class="list_sf" style="width: 300px; color: #F79420;">Flight Schedule Management</div>
        <a href="./UserManagement.html">
            <div class="list_sf">User Management</div>
        </a>
        <div class="list_out">Logout</div>
    </div>
    <div class="searchlist">
        <div class="fromto">
            <div class="dropdown">
                <p style="line-height: 30px;">From City:</p>
                <select class="fromCity">
                    <option value="volvo">Beijing</option>
                </select>
            </div>
            <div class="change">
                <input type="button" onClick="" class="changeicon" value="" />
            </div>
            <div class="dropdown">
                <p style="line-height: 30px;">To City:</p>
                <select class="toCity">
                    <option value="volvo">Rome</option>
                </select>
            </div>
        </div>
        <div class="fromto" style="width:300px;">
            <div class="optiondate">
                <p style="line-height: 30px;">Departure Date：</p>
                <input class="startDate" style="width: 120px;" type="date" value="2019-09-15" />
            </div>
            <div class="optiondate">
                <p>To：</p>
                <input class="endDate" style="width: 120px;" type="date" value="2019-09-25" />
            </div>
        </div>
        <div class="searchbutton">
            <input class="searchBtn" type="button" name="" id="show" value="Search" />
        </div>
    </div>
    <div class="formclass" style="height: 260px;">
        <table>
            <thead>
                <tr class="thead">
                    <th>Date</th>
                    <th>Time</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Aircraft</th>
                    <th>Economy Price</th>
                    <th>Flight Number</th>
                    <th>Gate</th>
                    <th>Status</th>
                    <th>Operater</th>
                </tr>
            </thead>
            <tbody class="resultList">
                <tr class="tdcolor">
                    <td>2018-06-25</td>
                    <td>08:05</td>
                    <td>Beijing/PEK</td>
                    <td>Rome/CIA</td>
                    <td>Boeing 737-800</td>
                    <td>400</td>
                    <td>101</td>
                    <td>F30</td>
                    <td>Confirmed</td>
                    <td><input type='button' value='Cancel' /></td>
                </tr>
                <tr class="tdcolor1">
                    <td>2018-06-25</td>
                    <td>08:05</td>
                    <td>Beijing/PEK</td>
                    <td>Rome/CIA</td>
                    <td>Boeing 737-800</td>
                    <td>400</td>
                    <td>101</td>
                    <td>F30</td>
                    <td>Canceled</td>
                    <td><input type='button' value='Confirm' /></td>
                </tr>

            </tbody>
        </table>
    </div>

</body>
<script src="./js/jquery-3.4.1.min.js"></script>

<script>

    $(".searchBtn").click(function () {
        searchList();
    })


    $.ajax({
        type: "post",
        url: "http://localhost:8080/SunshineAirlines/getCityNames",

        success(msg) {
            var json = JSON.parse(msg);
            var html = ""
            for (let i = 0; i < json.data.length; i++) {
                html += `<option value="${json.data[i].CityName}">${json.data[i].CityName}</option>`;
            }

            $(".fromCity").html(html);
            $(".toCity").html(html);

        }

    })

    $(".changeicon").click(function () {
        var fromCity = $(".fromCity").val();
        var toCity = $(".toCity").val();

        $(".fromCity").val(toCity);
        $(".toCity").val(fromCity);

    })




    function searchList() {
        var fromCity = $(".fromCity").val();
        var toCity = $(".toCity").val();
        var startDate = $(".startDate").val();
        var endDate = $(".endDate").val();
        // <td><input type='button' onclick=update(${json.data[i].ScheduleId},'${newstatus}ed') value='${newstatus}' /></td>

        $.ajax({
            type: "post",
            url: "http://localhost:8080/SunshineAirlines/getSchedule",
            data: { fromCity, toCity, startDate, endDate },

            success(msg) {
                json = JSON.parse(msg);
                var html = "";

                if (json.flag == "success") {
                    for (let i = 0; i < json.data.length; i++) {
                        var newstatus = json.data[i].Status == "Confirmed" ? 'Cancel' : 'Confirm';
                        html += `
                        <tr class="tdcolor1">                           
                        <td>${json.data[i].Date.substring(0, 10)}</td>
                        <td>${json.data[i].Time.substring(0, 5)}</td>
                        <td>${json.data[i].DepartCityName}/${json.data[i].DepartureAirportIATA}</td>
                        <td>${json.data[i].ArriveCityName}/${json.data[i].ArrivalAirportIATA}</td>
                        <td>${json.data[i].Name}</td>
                        <td>${json.data[i].EconomyPrice}</td>
                        <td>${json.data[i].FlightNumber}</td>
                        <td>${json.data[i].Gate}</td>
                        <td>${json.data[i].Status}</td>
                        <td><input type='button' onclick=update(${json.data[i].ScheduleId},'${newstatus}ed') value='${newstatus}' /></td>
                        </tr>
                        
                        `;

                    }
                    $(".resultList").html(html);

                }

            }


        })

    }


    function update(scheduleId, status) {
        $.ajax({
            type: "post",
            url: "http://localhost:8080/SunshineAirlines/updateSchedule",
            data: { scheduleId, status },

            success(msg) {
                var json = JSON.parse(msg);
                if (json.flag == "success") {
                    searchList();
                }

            }

        })
    }
//123


</script>

</html>